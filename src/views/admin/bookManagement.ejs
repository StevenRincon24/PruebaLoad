<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../templates/header.ejs')%>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="../assets/img/sidebar-5.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a class="simple-text">
                        <img src="https://leonautas.files.wordpress.com/2019/10/biblioteca-logo.png"
                            style="height: 80px;">
                    </a>
                </div>
                <ul class="nav">
                    <% if(data==='admin' ){%>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/dashBoard/employeeManagement"
                                id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                                <i class="fa-solid fa-users"></i>
                                <span>Employees</span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="/dashBoard/employeeManagement">Employees list</a>

                                <div class="divider"></div>
                                <a class="dropdown-item" href="/dashBoard/createEmployee">Add employee</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/dashBoard/bookManagement"
                                id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                                <i class="fa-solid fa-book"></i>
                                <span>Books</span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="/dashBoard/bookManagement">Book list</a>

                                <div class="divider"></div>
                                <a class="dropdown-item" href="/dashBoard/createBookManagement">Add Book</a>
                            </div>
                        </li>
                        <%}%>
                            <% if(data==='employee' ){%>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="/dashBoard/bookManagement"
                                        id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        <i class="fa-solid fa-book"></i>
                                        <span>Books</span>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="/dashBoard/bookManagement">List Books</a>

                                        <div class="divider"></div>
                                        <a class="dropdown-item" href="/dashBoard/createBookManagement">Add Book</a>
                                    </div>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="/dashBoard/customersManagement"
                                        id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        <i class="fa-solid fa-people-group"></i>
                                        <span>Customers</span>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="/dashBoard/customersManagement">List
                                            Customers</a>

                                        <div class="divider"></div>
                                        <a class="dropdown-item" href="/dashboard/registerCustomer">Add Customer</a>
                                    </div>
                                </li>


                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="/" id="navbarDropdownMenuLink"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa-solid fa-note-sticky"></i>
                                        <span>Loans</span>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="/">List
                                            Loans</a>

                                        <div class="divider"></div>
                                        <a class="dropdown-item" href="/">Add Loan</a>
                                    </div>
                                </li>
                                <%}%>
                                    <% if(data==='customer' ){%>
                                        <li>
                                            <a class="nav-link" href="./user.html">
                                                <i class="fa-solid fa-note-sticky"></i>
                                                <p>Leans history</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="nav-link" href="./user.html">
                                                <i class="fa-solid fa-file-circle-question"></i>
                                                <p>Leans pending</p>
                                            </a>
                                        </li>
                                        <%}%>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500" data-image="../assets/img/sidebar-5.jpg">
                <div class="container-fluid">
                    <a class="navbar-brand">
                        <%=data.toUpperCase() %>
                    </a>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">

                        <ul class="navbar-nav ml-auto">

                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="http://example.com"
                                    id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    <span class="no-icon">
                                        <%=username%>
                                    </span>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="#">Update data</a>
                                    <div class="divider"></div>
                                    <a class="dropdown-item" href="#">Log out</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card strpied-tabled-with-hover">
                                <div class="card-header ">
                                    <h4 class="card-title">Books</h4>

                                </div>
                                <div class="card-body table-full-width table-responsive">
                                    <table class="table table-hover table-striped">
                                        <thead>
                                            <th>ISBN</th>
                                            <th>Name</th>
                                            <th>Author</th>
                                            <th>Genre</th>
                                            <th>Number of copies</th>
                                            <th>Date publication</th>
                                            <th>Fine value</th>
                                            <th>Actions</th>
                                        </thead>
                                        <tbody>
                                            <% books.forEach(function(book) { %>
                                                <tr>
                                                    <td>
                                                        <%= book.id %>
                                                    </td>
                                                    <td>
                                                        <%= book.name %>
                                                    </td>
                                                    <td>
                                                        <%= book.author %>
                                                    </td>
                                                    <td>
                                                        <%= book.genre %>
                                                    </td>
                                                    <td>
                                                        <%= book.copies %>
                                                    </td>
                                                    <td>
                                                        <%= book.publication %>
                                                    </td>
                                                    <td>
                                                        <%= book.fine %>
                                                    </td>
                                                    <td>
                                                        <button class="btn btn-danger"
                                                            onclick="deleteBook('<%= book.id %>')">Delete</button>
                                                        <button class="btn btn-primary"
                                                            onclick="editBook('<%- encodeURIComponent(JSON.stringify(book)) %>')"
                                                            data-toggle="modal" data-target="#editModal">Edit</button>
                                                    </td>
                                                </tr>
                                                <% }) %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!--END TABLE-->

                        <div class="modal fade" id="editModal" tabindex="-1" role="dialog"
                            aria-labelledby="editModalLabel" aria-hidden="true">
                            <div class="modal-dialog" role="document">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="editModalLabel">Edit Book</h5>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="card">
                                            <div class="card-header">
                                                <h4 class="card-title">Edit Book</h4>
                                            </div>
                                            <div class="card-body">
                                                <form method="post" action="/dashboard/bookManagement/edit">
                                                    <input type="hidden" name="_method" value="PATCH">
                                                    <div class="row">
                                                        <div class="col-md-4 pr-1">
                                                            <div class="form-group">
                                                                <label>ISBN</label>
                                                                <input type="text" class="form-control"
                                                                    placeholder="ISBN" name="id1" id="ISBN1" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-8 pl-1">
                                                            <div class="form-group">
                                                                <label>Name</label>
                                                                <input type="text" class="form-control" name="name"
                                                                    id="name1" required>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-8 pr-1">
                                                            <div class="form-group">
                                                                <label>Author</label>
                                                                <input type="text" class="form-control" name="author"
                                                                    id="author1" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label>Genre</label>
                                                                <input id="genre1" type="text" class="form-control"
                                                                    name="genre" required>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="row">
                                                        <div class="col-md-4 pr-1">
                                                            <div class="form-group">
                                                                <label>Number of copies</label>
                                                                <input id="copies1" type="number" class="form-control"
                                                                    name="copies" required>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label>Date publication</label>
                                                                <input id="date1" type="date" class="form-control"
                                                                    name="date" required>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4 pl-1">
                                                            <div class="form-group">
                                                                <label>Fine value</label>
                                                                <input id="fine1" type="text" class="form-control"
                                                                    name="fine">
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4 pl-1" style="display: none;">
                                                            <div class="form-group">
                                                                <label>ISBN</label>
                                                                <input id="isbnA" type="text" class="form-control"
                                                                    name="id">
                                                            </div>
                                                        </div>

                                                    </div>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary"
                                                    data-dismiss="modal">Close</button>
                                                <button type="submit" class="btn btn-primary">Save changes</button>
                                            </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <footer class="footer">
                            <div class="container-fluid">
                                <nav>
                                    <ul class="footer-menu">
                                        <li>
                                            <a href="#">
                                                Home
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Company
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Portfolio
                                            </a>
                                        </li>
                                        <li>
                                            <a href="#">
                                                Blog
                                            </a>
                                        </li>
                                    </ul>
                                    <p class="copyright text-center">
                                        Â©
                                        <script>
                                            document.write(new Date().getFullYear())
                                        </script>
                                        <a href="http://www.creative-tim.com">Creative Tim</a>, made with love for a
                                        better web
                                    </p>
                                </nav>
                            </div>
                        </footer>
                    </div>
                </div>
</body>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
    function deleteBook(ISBN) {
        console.log("ISBN ", ISBN)
        swal({
            title: "Are you sure?",
            text: "This action will delete this register. Do you want to continue?",
            icon: "warning",
            buttons: ["Abort", "Confirm"],
            dangerMode: true,
        })
            .then((confirmed) => {
                if (confirmed) {
                    console.log(ISBN)
                    fetch(`/dashboard/booksManagement/delete/${ISBN}`, {
                        method: 'DELETE'
                    }).then(response => {
                        if (response.ok) {
                            swal("The register was deleted successfully!", {
                                icon: "success",
                            })
                                .then(() => {
                                    window.location.href = "/dashboard/bookManagement"
                                });
                        } else {
                            swal("Error deleting the register.", {
                                icon: "error",
                            }).catch(error => {
                                console.error('Error deleting the register:', error);
                                swal("Error deleting the register.", {
                                    icon: "error",
                                });
                            })

                        }
                    })
                }
            })
    }

    function editBook(bookString) {
        var book = JSON.parse(decodeURIComponent(bookString))
        document.getElementById('ISBN1').value = book.id
        document.getElementById('isbnA').value = book.id
        document.getElementById('name1').value = book.name
        document.getElementById('author1').value = book.author
        document.getElementById('genre1').value = book.genre
        document.getElementById('copies1').value = book.copies
        document.getElementById('date1').value = book.publication
        document.getElementById('fine1').value = book.fine
    }
</script>
<!--   Core JS Files   -->
<script src="../assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="../assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!--  Chartist Plugin  -->
<script src="../assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="../assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="../assets/js/demo.js"></script>
<script src="https://kit.fontawesome.com/0738a87bcc.js" crossorigin="anonymous"></script>

</html>