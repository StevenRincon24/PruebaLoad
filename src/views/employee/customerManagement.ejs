<!DOCTYPE html>
<html lang="en">

<head>
    <%- include('../templates/header.ejs')%>
</head>

<body>
    <div class="wrapper">
        <div class="sidebar" data-image="../assets/img/sidebar-5.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="sidebar-wrapper">
                <div class="logo">
                    <a class="simple-text">
                        <img src="https://leonautas.files.wordpress.com/2019/10/biblioteca-logo.png"
                            style="height: 80px;">
                    </a>
                </div>
                <ul class="nav">
                    <% if(data==='admin' ){%>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/dashBoard/employeeManagement"
                                id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                                <i class="fa-solid fa-users"></i>
                                <span>Employees</span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="/dashBoard/employeeManagement">List Employees</a>

                                <div class="divider"></div>
                                <a class="dropdown-item" href="/dashBoard/createEmployee">Add Employee</a>
                            </div>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="/dashBoard/bookManagement"
                                id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                aria-expanded="false">
                                <i class="fa-solid fa-book"></i>
                                <span>Books</span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                <a class="dropdown-item" href="/dashBoard/bookManagement">Book list</a>

                                <div class="divider"></div>
                                <a class="dropdown-item" href="/dashBoard/createBookManagement">Add Book</a>
                            </div>
                        </li>
                        <%}%>
                            <% if(data==='employee' ){%>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="/dashBoard/bookManagement"
                                        id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        <i class="fa-solid fa-book"></i>
                                        <span>Books</span>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="/dashBoard/bookManagement">List Books</a>

                                        <div class="divider"></div>
                                        <a class="dropdown-item" href="/dashBoard/createBookManagement">Add Book</a>
                                    </div>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="/dashBoard/customersManagement"
                                        id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                        aria-expanded="false">
                                        <i class="fa-solid fa-people-group"></i>
                                        <span>Customers</span>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="/dashBoard/customersManagement">List
                                            Customers</a>

                                        <div class="divider"></div>
                                        <a class="dropdown-item" href="/dashboard/registerCustomer">Add Customer</a>
                                    </div>
                                </li>


                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="/" id="navbarDropdownMenuLink"
                                        data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <i class="fa-solid fa-note-sticky"></i>
                                        <span>Loans</span>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                        <a class="dropdown-item" href="/dashBoard/loansManagement">List
                                            Loans</a>

                                        <div class="divider"></div>
                                        <a class="dropdown-item" href="/dashboard/registerLoan">Add Loan</a>
                                    </div>
                                </li>

                                <%}%>
                                    <% if(data==='customer' ){%>
                                        <li>
                                            <a class="nav-link" href="./user.html">
                                                <i class="fa-solid fa-note-sticky"></i>
                                                <p>Leans history</p>
                                            </a>
                                        </li>
                                        <li>
                                            <a class="nav-link" href="./user.html">
                                                <i class="fa-solid fa-file-circle-question"></i>
                                                <p>Leans pending</p>
                                            </a>
                                        </li>
                                        <%}%>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <nav class="navbar navbar-expand-lg " color-on-scroll="500" data-image="../assets/img/sidebar-5.jpg">
                <div class="container-fluid">
                    <a class="navbar-brand">
                        <%=data.toUpperCase() %>
                    </a>
                    <div class="collapse navbar-collapse justify-content-end" id="navigation">

                        <ul class="navbar-nav ml-auto">

                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="http://example.com"
                                    id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                                    aria-expanded="false">
                                    <span class="no-icon">
                                        <%=username%>
                                    </span>
                                </a>
                                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                                    <a class="dropdown-item" href="#">Update data</a>
                                    <div class="divider"></div>
                                    <a class="dropdown-item" href="#">Log out</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>
            <!-- End Navbar -->
            <!-- Content -->
            <div class="content">
                <div class="container-fluid">
                    <div class="section">
                        <h1 class="text-center mb-4" style="font-family: 'Arial Rounded MT Bold', sans-serif">Customers
                            Management</h1>

                        <br>
                        <div class="container">
                            <div class="table-responsive">
                                <table id="tableCustomers" class="table table-striped table-bordered border-dark">
                                    <thead class="text-center" style="background: #000000; color: black">
                                        <tr>
                                            <th>Name</th>
                                            <th>Last Name</th>
                                            <th>Document Type</th>
                                            <th>Document Number</th>
                                            <th>Celphone Number</th>
                                            <th>Address</th>
                                            <th>Birthday</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="text-center align-middle" style="background-color: #F9F9F9">
                                        <% customers.forEach(function(customer) { %>
                                            <tr>
                                                <td>
                                                    <%= customer.name %>
                                                </td>
                                                <td>
                                                    <%= customer.lastName %>
                                                </td>
                                                <td>
                                                    <%= customer.documentType %>
                                                </td>
                                                <td>
                                                    <%= customer.documentNumber %>
                                                </td>
                                                <td>
                                                    <%= customer.cellphone %>
                                                </td>
                                                <td>
                                                    <%= customer.address %>
                                                </td>
                                                <td>
                                                    <%= customer.birthday %>
                                                </td>
                                                <td>
                                                    <button class="btn btn-danger"
                                                        onclick="deleteUser('<%= customer.username %>')">Delete</button>
                                                    <button class="btn btn-primary"
                                                        onclick="editUser('<%- encodeURIComponent(JSON.stringify(customer)) %>')"
                                                        data-toggle="modal" data-target="#editModal">Edit</button>
                                                </td>
                                            </tr>
                                            <% }) %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="editModalLabel">Edit Customer</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <div class="card">
                                        <div class="card-header">
                                            <h4 class="card-title">Edit customer</h4>
                                        </div>
                                        <div class="card-body">
                                            <form method="post" action="/dashboard/customersManagement/edit">
                                                <input type="hidden" name="_method" value="PATCH">
                                                <div class="row">
                                                    <div class="col-md-6 pr-1">
                                                        <div class="form-group">
                                                            <label>First Name</label>
                                                            <input type="text" class="form-control"
                                                                placeholder="First Name" name="name" id="name1"
                                                                required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 pl-1">
                                                        <div class="form-group">
                                                            <label>Last Name</label>
                                                            <input type="text" class="form-control"
                                                                placeholder="Last Name" name="lastName" id="lastName1"
                                                                required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 pr-1">
                                                        <div class="form-group">
                                                            <label for="documentType">Document Type</label>
                                                            <select class="form-select form-control" id="documentType1"
                                                                name="documentType" required="required">
                                                                <option value="Citizenship card">Citizenship card
                                                                </option>
                                                                <option value="Foreigner ID">Foreigner ID</option>
                                                                <option value="NIT">NIT</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 pl-1">
                                                        <div class="form-group">
                                                            <label for="documentNumber">Document Number</label>
                                                            <input id="documentNumber1" type="number"
                                                                class="form-control" name="documentNumber" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 pr-1">
                                                        <div class="form-group">
                                                            <label>Birthday</label>
                                                            <input id="birthday1" type="date" class="form-control"
                                                                name="birthday" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 pl-1">
                                                        <div class="form-group">
                                                            <label>Cellphone</label>
                                                            <input id="cellphone1" type="number" class="form-control"
                                                                name="cellphone" placeholder="Cellphone" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 pl-1">
                                                        <div class="form-group">
                                                            <label>Address</label>
                                                            <input id="address1" type="text" class="form-control"
                                                                name="address" placeholder="address" required>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-4 pl-1">
                                                        <div class="form-group">
                                                            <label>Rol</label>
                                                            <input id="rol1" type="text" class="form-control" name="rol"
                                                                placeholder="rol" readonly>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col-md-6 pr-1">
                                                        <div class="form-group">
                                                            <label>Username</label>
                                                            <input id="username1" type="email" class="form-control"
                                                                placeholder="Username" name="username" readonly>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6 pl-1">
                                                        <div class="form-group">
                                                            <label>Password</label>
                                                            <input id="password1" type="password" class="form-control"
                                                                placeholder="Password" name="password" readonly>
                                                        </div>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 pr-1">
                                                            <div class="form-group">
                                                                <label>Username</label>
                                                                <input id="username1" type="email" class="form-control"
                                                                    placeholder="Username" name="username" readonly>
                                                            </div>
                                                        </div>
                                                        <div class="col-md-6 pl-1">
                                                            <div class="form-group">
                                                                <label>Password</label>
                                                                <input id="password1" type="password"
                                                                    class="form-control" placeholder="Password"
                                                                    name="password" readonly>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary"
                                                data-dismiss="modal">Close</button>
                                            <button type="submit" class="btn btn-primary">Save changes</button>
                                        </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- endcontent-->
            <footer class="footer">
                <div class="container-fluid">
                    <nav>
                        <ul class="footer-menu">
                            <li>
                                <a href="#">
                                    Home
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Company
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Portfolio
                                </a>
                            </li>
                            <li>
                                <a href="#">
                                    Blog
                                </a>
                            </li>
                        </ul>
                        <p class="copyright text-center">
                            Â©
                            <script>
                                document.write(new Date().getFullYear())
                            </script>
                            <a href="http://www.creative-tim.com">Creative Tim</a>, made with love for a better web
                        </p>
                    </nav>
                </div>
            </footer>
        </div>
    </div>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>
        function deleteUser(username) {
            swal({
                title: "Are you sure?",
                text: "This action will delete this register. Do you want to continue?",
                icon: "warning",
                buttons: ["Abort", "Confirm"],
                dangerMode: true,
            })
                .then((confirmed) => {
                    if (confirmed) {
                        console.log(username)
                        fetch(`/dashboard/customersManagement/delete/${username}`, {
                            method: 'DELETE'
                        }).then(response => {
                            if (response.ok) {
                                swal("The register was deleted successfully!", {
                                    icon: "success",
                                })
                                    .then(() => {
                                        window.location.href = "/dashboard/customersManagement"
                                    });
                            } else {
                                swal("Error deleting the register.", {
                                    icon: "error",
                                }).catch(error => {
                                    console.error('Error deleting the register:', error);
                                    swal("Error deleting the register.", {
                                        icon: "error",
                                    });
                                })
                            }
                        })
                    }
                })
        }
        function editUser(customerString) {
            var customer = JSON.parse(decodeURIComponent(customerString))
            document.getElementById('name1').value = customer.name
            document.getElementById('lastName1').value = customer.lastName
            document.getElementById('documentType1').value = customer.documentType
            document.getElementById('documentNumber1').value = customer.documentNumber
            document.getElementById('birthday1').value = customer.birthday
            document.getElementById('cellphone1').value = customer.cellphone
            document.getElementById('address1').value = customer.address
            document.getElementById('username1').value = customer.username
            document.getElementById('password1').value = customer.password
            document.getElementById('rol1').value = customer.rol
        }
    </script>
    }
    function editUser(customerString) {
    var customer = JSON.parse(decodeURIComponent(customerString))
    document.getElementById('name1').value = customer.name
    document.getElementById('lastName1').value = customer.lastName
    document.getElementById('documentType1').value = customer.documentType
    document.getElementById('documentNumber1').value = customer.documentNumber
    document.getElementById('birthday1').value = customer.birthday
    document.getElementById('cellphone1').value = customer.cellphone
    document.getElementById('address1').value = customer.address
    document.getElementById('username1').value = customer.username
    document.getElementById('password1').value = customer.password
    }
    </script>
</body>
<!--   Core JS Files   -->
<script src="../assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
<script src="../assets/js/core/popper.min.js" type="text/javascript"></script>
<script src="../assets/js/core/bootstrap.min.js" type="text/javascript"></script>
<!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
<script src="../assets/js/plugins/bootstrap-switch.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!--  Chartist Plugin  -->
<script src="../assets/js/plugins/chartist.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../assets/js/plugins/bootstrap-notify.js"></script>
<!-- Control Center for Light Bootstrap Dashboard: scripts for the example pages etc -->
<script src="../assets/js/light-bootstrap-dashboard.js?v=2.0.0 " type="text/javascript"></script>
<!-- Light Bootstrap Dashboard DEMO methods, don't include it in your project! -->
<script src="../assets/js/demo.js"></script>
<script src="https://kit.fontawesome.com/0738a87bcc.js" crossorigin="anonymous"></script>

</html>